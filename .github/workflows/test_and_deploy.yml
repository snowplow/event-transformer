name: Test and deploy

on: push

jobs:
  test_and_deploy:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v2

      - name: Set up JDK 11
        uses: actions/setup-java@v1
        with:
          java-version: 11

      - name: Run tests
        run: sbt coverage +test

      - name: Check Scala formatting
        run: sbt scalafmtCheck

      - name: Aggregate coverage data
        run: sbt coverageAggregate

      - name: Deploy to maven
        if: .github/check_tag.sh ${{ github.ref }}
        run: sbt +publish

      - name: Deploy Github pages
        if: .github/check_tag.sh ${{ github.ref }}
        run: |
          git config user.name "GitHub Actions"
          git config user.email "<>"
          sbt ghpagesPushSite
